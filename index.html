<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Warung Online - Soto, Bakso, Mie Ayam & Kebab</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
    />
    <style>
      :root {
        --primary-color: #dc3545;
        --secondary-color: #fd7e14;
        --dark-color: #212529;
        --light-bg: #f8f9fa;
        --success-color: #28a745;
        --info-color: #17a2b8;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--light-bg);
        color: var(--dark-color);
        line-height: 1.6;
      }

      /* Navbar */
      .navbar {
        background: linear-gradient(
          135deg,
          var(--dark-color) 0%,
          #343a40 100%
        ) !important;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 0.75rem 0;
      }

      .navbar-brand {
        font-weight: 700;
        font-size: 1.5rem;
      }

      .nav-link {
        font-weight: 500;
        margin: 0 0.5rem;
        transition: all 0.3s ease;
      }

      .nav-link:hover {
        color: var(--primary-color) !important;
      }

      /* Hero Section */
      .hero-section {
        background: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          var(--secondary-color) 100%
        );
        color: white;
        padding: 60px 0;
        text-align: center;
      }

      .hero-content h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 1rem;
      }

      .hero-content p {
        font-size: 1.2rem;
        margin-bottom: 2rem;
      }

      /* Cards */
      .food-card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        height: 100%;
        border: none;
        margin-bottom: 20px;
      }

      .food-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
      }

      .food-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
      }

      .food-card-body {
        padding: 15px;
      }

      .food-title {
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 8px;
        color: var(--dark-color);
      }

      .food-description {
        color: #6c757d;
        font-size: 0.9rem;
        margin-bottom: 15px;
        min-height: 40px;
      }

      .price-tag {
        background: var(--primary-color);
        color: white;
        padding: 6px 15px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
      }

      .food-actions {
        display: flex;
        gap: 8px;
        margin-top: 15px;
      }

      /* Buttons */
      .btn-custom {
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 500;
        transition: all 0.3s ease;
        border: none;
        font-size: 0.9rem;
      }

      .btn-primary-custom {
        background: var(--primary-color);
        color: white;
      }

      .btn-primary-custom:hover {
        background: #c82333;
        color: white;
      }

      .btn-outline-custom {
        background: transparent;
        color: var(--primary-color);
        border: 1px solid var(--primary-color);
      }

      .btn-outline-custom:hover {
        background: var(--primary-color);
        color: white;
      }

      /* Cart */
      .cart-badge {
        position: absolute;
        top: -8px;
        right: -8px;
        background: var(--secondary-color);
        color: white;
        border-radius: 50%;
        width: 22px;
        height: 22px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: 700;
      }

      .cart-sidebar {
        position: fixed;
        right: -400px;
        top: 0;
        width: 400px;
        height: 100vh;
        background: white;
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        transition: right 0.3s ease;
        z-index: 1050;
        overflow-y: auto;
      }

      .cart-sidebar.show {
        right: 0;
      }

      .cart-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        z-index: 1040;
      }

      .cart-overlay.show {
        display: block;
      }

      /* Forms */
      .auth-form {
        max-width: 400px;
        margin: 100px auto;
        padding: 30px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .customer-info {
        background: white;
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      /* Admin Dashboard */
      .admin-dashboard {
        display: none;
      }

      .stats-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        text-align: center;
      }

      .stats-icon {
        font-size: 2rem;
        margin-bottom: 10px;
      }

      .stats-number {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 5px;
      }

      .order-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border-left: 4px solid var(--primary-color);
      }

      .status-badge {
        padding: 5px 12px;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;
      }

      .status-pending {
        background: #fff3cd;
        color: #856404;
      }

      .status-processing {
        background: #d1ecf1;
        color: #0c5460;
      }

      .status-ready {
        background: #d4edda;
        color: #155724;
        animation: pulse 2s infinite;
      }

      .status-completed {
        background: #e2e3e5;
        color: #383d41;
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.4);
        }
        70% {
          box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
        }
      }

      /* Login Form */
      .form-control,
      .form-select {
        border-radius: 8px;
        border: 1px solid #ddd;
        padding: 10px 15px;
      }

      .form-control:focus,
      .form-select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
      }

      /* History Section */
      .history-section {
        background: white;
        border-radius: 12px;
        padding: 25px;
        margin: 30px 0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .history-item {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        border-left: 3px solid var(--primary-color);
        transition: all 0.3s ease;
      }

      .history-item.ready-order {
        background: #d4edda;
        border-left-color: #28a745;
        animation: highlight 3s ease;
      }

      @keyframes highlight {
        0% {
          background-color: #f8f9fa;
        }
        50% {
          background-color: #d4edda;
        }
        100% {
          background-color: #d4edda;
        }
      }

      /* Notification */
      .notification {
        position: fixed;
        top: 80px;
        right: 20px;
        padding: 12px 20px;
        background: white;
        color: var(--dark-color);
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 1060;
        display: none;
        border-left: 4px solid var(--success-color);
      }

      .order-ready-notification {
        position: fixed;
        top: 80px;
        right: 20px;
        padding: 15px 20px;
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(40, 167, 69, 0.3);
        z-index: 1070;
        display: none;
        max-width: 350px;
        animation: slideIn 0.5s ease;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      /* Real-time Status Indicator */
      .realtime-indicator {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: rgba(40, 167, 69, 0.9);
        color: white;
        padding: 8px 15px;
        border-radius: 20px;
        font-size: 0.8rem;
        display: none;
        align-items: center;
        z-index: 1030;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }

      .realtime-indicator i {
        margin-right: 5px;
        animation: blink 1.5s infinite;
      }

      @keyframes blink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.3;
        }
      }

      /* Sync Modal */
      .sync-modal .modal-body {
        max-height: 70vh;
        overflow-y: auto;
      }

      .sync-instructions {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .sync-code-area {
        position: relative;
      }

      .sync-code {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        font-family: monospace;
        font-size: 0.85rem;
        word-break: break-all;
        max-height: 200px;
        overflow-y: auto;
        margin-bottom: 10px;
      }

      .sync-actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }

      /* File Input Styling */
      .file-input-wrapper {
        position: relative;
        overflow: hidden;
        display: inline-block;
        width: 100%;
      }

      .file-input-wrapper input[type="file"] {
        position: absolute;
        left: -9999px;
      }

      .file-input-label {
        display: block;
        padding: 10px 15px;
        background: var(--primary-color);
        color: white;
        border-radius: 8px;
        cursor: pointer;
        text-align: center;
        transition: background-color 0.3s;
      }

      .file-input-label:hover {
        background: #c82333;
      }

      /* Search and Filter */
      .search-box {
        position: relative;
        margin-bottom: 15px;
      }

      .search-box input {
        padding-left: 40px;
        border-radius: 25px;
      }

      .search-box i {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
      }

      .filter-pills {
        display: flex;
        gap: 8px;
        margin-bottom: 15px;
        flex-wrap: wrap;
      }

      .filter-pill {
        padding: 6px 15px;
        border-radius: 15px;
        background: #e9ecef;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9rem;
      }

      .filter-pill.active {
        background: var(--primary-color);
        color: white;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .cart-sidebar {
          width: 100%;
          right: -100%;
        }

        .hero-section {
          padding: 40px 0;
        }

        .hero-content h1 {
          font-size: 2rem;
        }

        .hero-content p {
          font-size: 1rem;
        }

        .food-card {
          margin-bottom: 15px;
        }

        .food-actions {
          flex-direction: column;
        }

        .btn-custom {
          width: 100%;
          margin-bottom: 5px;
        }

        .nav-link {
          margin: 0.25rem;
        }

        .stats-card {
          margin-bottom: 15px;
        }

        .order-card {
          padding: 15px;
        }

        .history-item {
          padding: 12px;
        }

        .sync-actions {
          flex-direction: column;
        }

        .order-ready-notification {
          right: 10px;
          left: 10px;
          max-width: none;
        }

        .realtime-indicator {
          bottom: 10px;
          right: 10px;
          font-size: 0.7rem;
          padding: 6px 12px;
        }
      }

      @media (max-width: 576px) {
        .filter-pills {
          justify-content: center;
        }
      }

      /* Loading Spinner */
      .spinner-border-sm {
        width: 1rem;
        height: 1rem;
        border-width: 0.15em;
      }
    </style>
  </head>
  <body>
    <!-- Notification -->
    <div class="notification" id="notification">
      <div class="d-flex align-items-center">
        <i class="bi bi-check-circle-fill me-2"></i>
        <span id="notificationText"></span>
      </div>
    </div>

    <!-- Order Ready Notification -->
    <div class="order-ready-notification" id="orderReadyNotification">
      <div class="d-flex align-items-center">
        <i class="bi bi-bell-fill me-3" style="font-size: 24px"></i>
        <div>
          <h6 class="mb-1 fw-bold">Pesanan Siap Diambil!</h6>
          <p class="mb-0" id="orderReadyText">
            Pesanan Anda sudah siap diambil.
          </p>
        </div>
      </div>
    </div>

    <!-- Real-time Status Indicator -->
    <div class="realtime-indicator" id="realtimeIndicator">
      <i class="bi bi-wifi"></i>
      <span>Real-time Aktif</span>
    </div>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container">
        <a class="navbar-brand" href="#" id="homeLink">
          <i class="bi bi-shop me-2"></i>Warung Online
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link" href="#" id="menuLink">Menu</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" id="historyLink">Riwayat</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" id="adminLink">Admin</a>
            </li>
          </ul>
          <div class="d-flex">
            <button
              class="btn btn-outline-light position-relative"
              id="cartBtn"
            >
              <i class="bi bi-cart3"></i>
              <span class="cart-badge" id="cartBadge">0</span>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Customer Login Form -->
    <div id="customerLogin" class="container">
      <div class="auth-form">
        <div class="text-center mb-4">
          <i
            class="bi bi-person-circle"
            style="font-size: 48px; color: var(--primary-color)"
          ></i>
          <h3 class="mt-3">Login Customer</h3>
          <p class="text-muted">Masuk untuk memesan makanan</p>
        </div>
        <form id="customerLoginForm">
          <div class="mb-3">
            <label for="customerName" class="form-label">Nama Lengkap</label>
            <input
              type="text"
              class="form-control"
              id="customerName"
              placeholder="Masukkan nama lengkap"
              required
            />
          </div>
          <div class="mb-3">
            <label for="customerPhone" class="form-label">No. Telepon</label>
            <input
              type="tel"
              class="form-control"
              id="customerPhone"
              placeholder="Masukkan nomor telepon"
              required
            />
          </div>
          <div class="mb-4">
            <label for="customerAddress" class="form-label">Alamat</label>
            <textarea
              class="form-control"
              id="customerAddress"
              rows="3"
              placeholder="Masukkan alamat lengkap"
              required
            ></textarea>
          </div>
          <button type="submit" class="btn btn-primary-custom w-100">
            <i class="bi bi-box-arrow-in-right me-2"></i>Login
          </button>
        </form>
        <div class="text-center mt-3">
          <small class="text-muted"
            >Admin?
            <a href="#" onclick="showAdminLogin()">Login di sini</a></small
          >
        </div>
      </div>
    </div>

    <!-- Customer View -->
    <div id="customerView" style="display: none">
      <!-- Customer Info -->
      <div class="container mt-3">
        <div class="customer-info">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-1">
                Selamat datang, <span id="welcomeCustomerName"></span>
              </h6>
              <small class="text-muted">
                <i class="bi bi-telephone me-1"></i>
                <span id="welcomeCustomerPhone"></span>
              </small>
            </div>
            <button
              class="btn btn-outline-danger btn-sm"
              onclick="customerLogout()"
            >
              <i class="bi bi-box-arrow-right me-1"></i>Logout
            </button>
          </div>
        </div>
      </div>

      <!-- Hero Section -->
      <section class="hero-section">
        <div class="container hero-content">
          <h1>Warung Online</h1>
          <p>
            Nikmati hidangan lezat Soto, Bakso, Mie Ayam, dan Kebab favorit
            Anda!
          </p>
          <div>
            <button
              class="btn btn-light btn-lg me-2 mb-2"
              onclick="document.getElementById('menuSection').scrollIntoView({behavior: 'smooth'})"
            >
              <i class="bi bi-arrow-down-circle me-2"></i>Lihat Menu
            </button>
            <button
              class="btn btn-outline-light btn-lg mb-2"
              onclick="document.getElementById('historySection').scrollIntoView({behavior: 'smooth'})"
            >
              <i class="bi bi-clock-history me-2"></i>Riwayat
            </button>
          </div>
        </div>
      </section>

      <!-- Menu Section -->
      <section id="menuSection" class="container my-4">
        <div class="text-center mb-4">
          <h2 class="fw-bold">Menu Kami</h2>
          <p class="text-muted">Pilih hidangan favorit Anda</p>
        </div>

        <!-- Category Filter -->
        <div class="text-center mb-4">
          <button
            class="btn btn-outline-danger category-btn active me-2 mb-2"
            data-category="all"
          >
            <i class="bi bi-grid me-1"></i>Semua
          </button>
          <button
            class="btn btn-outline-danger category-btn me-2 mb-2"
            data-category="soto"
          >
            <i class="bi bi-cup-hot me-1"></i>Soto
          </button>
          <button
            class="btn btn-outline-danger category-btn me-2 mb-2"
            data-category="bakso"
          >
            <i class="bi bi-circle me-1"></i>Bakso
          </button>
          <button
            class="btn btn-outline-danger category-btn me-2 mb-2"
            data-category="mie"
          >
            <i class="bi bi-egg-fried me-1"></i>Mie
          </button>
          <button
            class="btn btn-outline-danger category-btn mb-2"
            data-category="kebab"
          >
            <i class="bi bi-geo-alt me-1"></i>Kebab
          </button>
        </div>

        <!-- Food Grid -->
        <div class="row" id="foodGrid">
          <!-- Food items will be dynamically inserted here -->
        </div>
      </section>

      <!-- History Section -->
      <section id="historySection" class="container my-4">
        <div class="history-section">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="fw-bold">Riwayat Pesanan</h3>
            <div>
              <button
                class="btn btn-outline-danger btn-sm me-2"
                onclick="refreshCustomerHistory()"
              >
                <i class="bi bi-arrow-clockwise me-1"></i>Refresh
              </button>
              <button
                class="btn btn-outline-danger btn-sm"
                onclick="showSyncModal()"
              >
                <i class="bi bi-arrow-left-right me-1"></i>Sync Data
              </button>
            </div>
          </div>
          <div id="customerHistory">
            <!-- History items will be dynamically inserted here -->
          </div>
        </div>
      </section>
    </div>

    <!-- Admin Login Form -->
    <div id="adminLogin" class="container" style="display: none">
      <div class="auth-form">
        <div class="text-center mb-4">
          <i
            class="bi bi-shield-lock"
            style="font-size: 48px; color: var(--primary-color)"
          ></i>
          <h3 class="mt-3">Login Admin</h3>
          <p class="text-muted">Masuk untuk mengelola pesanan</p>
        </div>
        <form id="adminLoginForm">
          <div class="mb-3">
            <label for="adminUsername" class="form-label">Username</label>
            <input
              type="text"
              class="form-control"
              id="adminUsername"
              placeholder="Username"
              required
            />
          </div>
          <div class="mb-4">
            <label for="adminPassword" class="form-label">Password</label>
            <input
              type="password"
              class="form-control"
              id="adminPassword"
              placeholder="Password"
              required
            />
          </div>
          <button type="submit" class="btn btn-primary-custom w-100">
            <i class="bi bi-box-arrow-in-right me-2"></i>Login
          </button>
        </form>
        <div class="text-center mt-3">
          <small class="text-muted"
            >Customer?
            <a href="#" onclick="showCustomerLogin()">Login di sini</a></small
          >
        </div>
      </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="admin-dashboard container my-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="fw-bold">Dashboard Admin</h2>
          <p class="text-muted">Kelola semua pesanan</p>
        </div>
        <div>
          <button
            class="btn btn-outline-danger btn-sm me-2"
            onclick="showSyncModal()"
          >
            <i class="bi bi-arrow-left-right me-1"></i>Sync Data
          </button>
          <button
            class="btn btn-outline-danger btn-sm me-2"
            onclick="refreshOrders()"
          >
            <i class="bi bi-arrow-clockwise me-1"></i>Refresh
          </button>
          <button class="btn btn-outline-danger btn-sm" id="logoutBtn">
            <i class="bi bi-box-arrow-right me-1"></i>Logout
          </button>
        </div>
      </div>

      <!-- Statistics Cards -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="stats-card">
            <div class="stats-icon text-danger">
              <i class="bi bi-cart-check"></i>
            </div>
            <div class="stats-number" id="totalOrders">0</div>
            <div class="text-muted">Total Pesanan</div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stats-card">
            <div class="stats-icon text-warning">
              <i class="bi bi-hourglass-split"></i>
            </div>
            <div class="stats-number" id="pendingOrders">0</div>
            <div class="text-muted">Menunggu</div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stats-card">
            <div class="stats-icon text-info">
              <i class="bi bi-gear"></i>
            </div>
            <div class="stats-number" id="processingOrders">0</div>
            <div class="text-muted">Diproses</div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stats-card">
            <div class="stats-icon text-success">
              <i class="bi bi-check-circle"></i>
            </div>
            <div class="stats-number" id="completedOrders">0</div>
            <div class="text-muted">Selesai</div>
          </div>
        </div>
      </div>

      <!-- Search and Filter -->
      <div class="card mb-3">
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <div class="search-box">
                <i class="bi bi-search"></i>
                <input
                  type="text"
                  class="form-control"
                  id="searchInput"
                  placeholder="Cari pesanan..."
                />
              </div>
            </div>
            <div class="col-md-6">
              <div class="filter-pills">
                <div class="filter-pill active" data-filter="all">Semua</div>
                <div class="filter-pill" data-filter="pending">Menunggu</div>
                <div class="filter-pill" data-filter="processing">Diproses</div>
                <div class="filter-pill" data-filter="ready">Siap</div>
                <div class="filter-pill" data-filter="completed">Selesai</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Orders List -->
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0 fw-bold">Daftar Pesanan</h5>
        </div>
        <div class="card-body">
          <div id="ordersList">
            <!-- Orders will be dynamically inserted here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Cart Sidebar -->
    <div class="cart-overlay" id="cartOverlay"></div>
    <div class="cart-sidebar" id="cartSidebar">
      <div class="p-3">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="mb-0">Keranjang Belanja</h4>
          <button class="btn-close" id="closeCartBtn"></button>
        </div>
        <div id="cartItems">
          <!-- Cart items will be dynamically inserted here -->
        </div>
        <div class="mt-3 pt-3 border-top">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">Total:</h5>
            <h5 class="mb-0 text-danger fw-bold" id="cartTotal">Rp 0</h5>
          </div>
          <button class="btn btn-primary-custom w-100" id="checkoutBtn">
            <i class="bi bi-check-circle me-2"></i>Checkout
          </button>
        </div>
      </div>
    </div>

    <!-- Checkout Modal -->
    <div class="modal fade" id="checkoutModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title fw-bold">Konfirmasi Pesanan</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Metode Pembayaran</label>
              <select class="form-select" id="paymentMethod" required>
                <option value="">Pilih metode pembayaran</option>
                <option value="cash">Cash (Bayar di tempat)</option>
                <option value="transfer">Transfer Bank</option>
                <option value="ewallet">E-Wallet</option>
              </select>
            </div>
            <div class="alert alert-info">
              <i class="bi bi-info-circle me-2"></i>
              Pesanan akan dibuat atas nama:
              <strong id="checkoutCustomerName"></strong>
            </div>
            <div id="orderSummary">
              <!-- Order summary will be dynamically inserted here -->
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button
              type="button"
              class="btn btn-primary-custom"
              id="confirmOrderBtn"
            >
              <i class="bi bi-check-circle me-2"></i>Konfirmasi Pesanan
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title fw-bold">Konfirmasi Hapus</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div class="text-center">
              <i
                class="bi bi-exclamation-triangle"
                style="font-size: 48px; color: var(--primary-color)"
              ></i>
              <p class="mt-3">Apakah Anda yakin ingin menghapus pesanan ini?</p>
              <p class="text-muted">Tindakan ini tidak dapat dibatalkan.</p>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
              <i class="bi bi-trash me-2"></i>Hapus
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Sync Modal -->
    <div class="modal fade sync-modal" id="syncModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title fw-bold">
              <i class="bi bi-arrow-left-right me-2"></i>Sinkronisasi Data
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div class="sync-instructions">
              <h6>
                <i class="bi bi-info-circle me-2"></i>Cara Sinkronisasi Data:
              </h6>
              <ol>
                <li>
                  <strong>Export Data:</strong> Klik "Generate Sync Code" untuk
                  membuat kode data
                </li>
                <li>
                  <strong>Salin Kode:</strong> Klik "Salin Code" atau salin
                  manual
                </li>
                <li>
                  <strong>Kirim Kode:</strong> Kirim kode ke device lain
                  (HP/Laptop)
                </li>
                <li>
                  <strong>Import Data:</strong> Di device lain, paste kode di
                  "Import from Code"
                </li>
                <li>
                  <strong>Atau Upload File:</strong> Upload file JSON yang sudah
                  diexport
                </li>
              </ol>
            </div>

            <div class="row">
              <div class="col-md-6">
                <h6>Export Data</h6>
                <div class="sync-code-area">
                  <div class="sync-code" id="exportCode">
                    Klik "Generate Sync Code" terlebih dahulu
                  </div>
                  <div class="sync-actions">
                    <button
                      class="btn btn-primary-custom btn-sm flex-fill"
                      onclick="generateSyncCode()"
                    >
                      <i class="bi bi-arrow-repeat me-2"></i>Generate Sync Code
                    </button>
                    <button
                      class="btn btn-outline-custom btn-sm flex-fill"
                      onclick="copySyncCode()"
                    >
                      <i class="bi bi-clipboard me-2"></i>Salin Code
                    </button>
                  </div>
                  <div class="sync-actions">
                    <button
                      class="btn btn-outline-custom btn-sm flex-fill"
                      onclick="exportToFile()"
                    >
                      <i class="bi bi-download me-2"></i>Export to File
                    </button>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <h6>Import Data</h6>
                <div class="sync-code-area">
                  <h6 class="mb-2">Option 1: Import from Code</h6>
                  <textarea
                    class="form-control"
                    id="importCode"
                    rows="4"
                    placeholder="Paste sync code di sini..."
                  ></textarea>
                  <div class="sync-actions">
                    <button
                      class="btn btn-primary-custom btn-sm flex-fill"
                      onclick="importFromCode()"
                    >
                      <i class="bi bi-download me-2"></i>Import from Code
                    </button>
                    <button
                      class="btn btn-outline-custom btn-sm flex-fill"
                      onclick="clearImportCode()"
                    >
                      <i class="bi bi-x me-2"></i>Clear
                    </button>
                  </div>
                </div>
                <div class="sync-code-area mt-3">
                  <h6 class="mb-2">Option 2: Import from File</h6>
                  <div class="file-input-wrapper">
                    <label for="importFile" class="file-input-label">
                      <i class="bi bi-upload me-2"></i>Choose JSON File
                    </label>
                    <input
                      type="file"
                      id="importFile"
                      accept=".json"
                      onchange="importFromFile(event)"
                    />
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-3">
              <h6>Statistik Data:</h6>
              <div class="row text-center">
                <div class="col-4">
                  <div class="fw-bold text-primary" id="totalOrdersCount">
                    0
                  </div>
                  <small class="text-muted">Total Pesanan</small>
                </div>
                <div class="col-4">
                  <div class="fw-bold text-success" id="totalCustomersCount">
                    0
                  </div>
                  <small class="text-muted">Total Customer</small>
                </div>
                <div class="col-4">
                  <div class="fw-bold text-info" id="lastSyncTime">
                    Belum pernah
                  </div>
                  <small class="text-muted">Last Sync</small>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Tutup
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Data
      const foods = [
        {
          id: 1,
          name: "Soto Ayam",
          category: "soto",
          price: 20000,
          image: "https://picsum.photos/seed/soto1/300/200",
          description: "Soto ayam dengan kuah gurih",
        },
        {
          id: 2,
          name: "Soto Daging",
          category: "soto",
          price: 25000,
          image: "https://picsum.photos/seed/soto2/300/200",
          description: "Soto daging sapi dengan rempah",
        },
        {
          id: 3,
          name: "Bakso Urat",
          category: "bakso",
          price: 15000,
          image: "https://picsum.photos/seed/bakso1/300/200",
          description: "Bakso urat kenyal",
        },
        {
          id: 4,
          name: "Bakso Beranak",
          category: "bakso",
          price: 20000,
          image: "https://picsum.photos/seed/bakso2/300/200",
          description: "Bakso besar berisi telur",
        },
        {
          id: 5,
          name: "Mie Ayam",
          category: "mie",
          price: 18000,
          image: "https://picsum.photos/seed/mie1/300/200",
          description: "Mie ayam dengan topping",
        },
        {
          id: 6,
          name: "Mie Jamur",
          category: "mie",
          price: 17000,
          image: "https://picsum.photos/seed/mie2/300/200",
          description: "Mie ayam dengan jamur",
        },
        {
          id: 7,
          name: "Kebab Turki",
          category: "kebab",
          price: 22000,
          image: "https://picsum.photos/seed/kebab1/300/200",
          description: "Kebab dengan daging sapi",
        },
        {
          id: 8,
          name: "Kebab Keju",
          category: "kebab",
          price: 25000,
          image: "https://picsum.photos/seed/kebab2/300/200",
          description: "Kebab dengan keju mozarella",
        },
      ];

      let cart = [];
      let orders = [];
      let currentView = "customerLogin";
      let isLoggedIn = false;
      let isAdmin = false;
      let currentUser = null;
      let orderToDelete = null;
      let currentFilter = "all";
      let searchTerm = "";
      let lastNotifiedOrders = new Set(); // Track orders that have been notified

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        checkURLParams();
        loadOrders();
        setupEventListeners();

        // Auto save every 5 seconds
        setInterval(autoSave, 5000);

        // Check for order status updates every 1 second for real-time updates
        setInterval(checkOrderStatusUpdates, 1000);

        // Setup localStorage event listener for cross-tab real-time updates
        setupLocalStorageListener();

        // Check if user is already logged in
        checkExistingLogin();
      });

      // Setup localStorage event listener for real-time updates
      function setupLocalStorageListener() {
        // Listen for storage events (when localStorage changes in another tab/window)
        window.addEventListener("storage", function (event) {
          if (event.key === "warungOnlineOrders") {
            console.log("Storage event detected, reloading orders...");
            // Orders data has been updated in another tab/window
            loadOrders();

            // Update UI based on current view
            if (currentView === "admin") {
              renderOrders();
            } else if (currentView === "customer") {
              renderCustomerHistory();
            }

            // Check for order status updates immediately
            checkOrderStatusUpdates();
          }
        });
      }

      // Check existing login
      function checkExistingLogin() {
        const savedUser = localStorage.getItem("warungOnlineUser");
        if (savedUser) {
          try {
            currentUser = JSON.parse(savedUser);
            if (currentUser.isAdmin) {
              showAdminDashboard();
            } else {
              showCustomerView();
            }
          } catch (error) {
            localStorage.removeItem("warungOnlineUser");
            showCustomerLogin();
          }
        } else {
          showCustomerLogin();
        }
      }

      // Check URL parameters for sync
      function checkURLParams() {
        const urlParams = new URLSearchParams(window.location.search);
        const syncData = urlParams.get("sync");

        if (syncData) {
          try {
            const decodedData = atob(syncData);
            const importedData = JSON.parse(decodedData);

            if (importedData.orders && Array.isArray(importedData.orders)) {
              // Merge orders, avoid duplicates
              importedData.orders.forEach((newOrder) => {
                const exists = orders.find((order) => order.id === newOrder.id);
                if (!exists) {
                  orders.push(newOrder);
                }
              });

              saveOrders();
              showNotification("Data berhasil disinkronkan!", "success");

              // Clean URL
              window.history.replaceState(
                {},
                document.title,
                window.location.pathname
              );
            }
          } catch (error) {
            console.error("Error parsing sync data:", error);
          }
        }
      }

      // Check for order status updates
      function checkOrderStatusUpdates() {
        if (!currentUser || currentUser.isAdmin) return;

        const customerOrders = orders.filter(
          (order) => order.customerId === currentUser.id
        );

        customerOrders.forEach((order) => {
          // Check if order is ready and hasn't been notified yet
          if (order.status === "ready" && !lastNotifiedOrders.has(order.id)) {
            console.log("Order ready detected:", order.id);
            showOrderReadyNotification(order);
            lastNotifiedOrders.add(order.id);

            // Highlight the order in history
            highlightOrderInHistory(order.id);
          }
        });
      }

      // Show order ready notification
      function showOrderReadyNotification(order) {
        const notification = document.getElementById("orderReadyNotification");
        const orderReadyText = document.getElementById("orderReadyText");

        orderReadyText.textContent = `Pesanan #${order.id} Anda sudah siap diambil!`;

        notification.style.display = "block";

        // Play notification sound if available
        playNotificationSound();

        // Auto hide after 10 seconds
        setTimeout(() => {
          notification.style.display = "none";
        }, 10000);
      }

      // Play notification sound
      function playNotificationSound() {
        try {
          // Create audio context for notification sound
          const audioContext = new (window.AudioContext ||
            window.webkitAudioContext)();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);

          oscillator.frequency.value = 800;
          oscillator.type = "sine";

          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioContext.currentTime + 0.5
          );

          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + 0.5);
        } catch (e) {
          console.log("Could not play notification sound");
        }
      }

      // Highlight order in history
      function highlightOrderInHistory(orderId) {
        const historyItems = document.querySelectorAll(".history-item");
        historyItems.forEach((item) => {
          const orderNumber = item.querySelector("h6");
          if (orderNumber && orderNumber.textContent.includes(`#${orderId}`)) {
            item.classList.add("ready-order");

            // Scroll to the order if it's not visible
            item.scrollIntoView({ behavior: "smooth", block: "center" });
          }
        });
      }

      // Storage Functions
      function saveOrders() {
        try {
          localStorage.setItem("warungOnlineOrders", JSON.stringify(orders));
          updateLastSyncTime();

          // Force storage event for cross-tab communication
          // This is a workaround to trigger storage event in the same tab
          const tempKey = "warungOnlineOrders_temp";
          localStorage.setItem(tempKey, Date.now().toString());
          localStorage.removeItem(tempKey);
        } catch (error) {
          console.error("Error saving orders:", error);
          showNotification("Gagal menyimpan data", "danger");
        }
      }

      function loadOrders() {
        try {
          const storedOrders = localStorage.getItem("warungOnlineOrders");
          if (storedOrders) {
            orders = JSON.parse(storedOrders);
            console.log("Orders loaded:", orders.length);
          }
        } catch (error) {
          console.error("Error loading orders:", error);
          orders = [];
        }
      }

      function autoSave() {
        if (orders.length > 0) {
          saveOrders();
        }
      }

      // Sync Functions
      function showSyncModal() {
        const modal = new bootstrap.Modal(document.getElementById("syncModal"));
        modal.show();
        updateSyncStats();
      }

      function generateSyncCode() {
        try {
          const syncData = {
            orders: orders,
            timestamp: new Date().toISOString(),
            generatedBy: currentUser ? currentUser.name : "Unknown",
          };

          const encodedData = btoa(JSON.stringify(syncData));
          const exportCode = document.getElementById("exportCode");
          exportCode.textContent = encodedData;

          showNotification("Sync code generated!", "success");
        } catch (error) {
          showNotification("Gagal generate sync code", "danger");
        }
      }

      function copySyncCode() {
        const exportCode = document.getElementById("exportCode");
        const text = exportCode.textContent;

        if (text && text !== 'Klik "Generate Sync Code" terlebih dahulu') {
          navigator.clipboard
            .writeText(text)
            .then(() => {
              showNotification("Code disalin ke clipboard!", "success");
            })
            .catch(() => {
              // Fallback for older browsers
              exportCode.select();
              document.execCommand("copy");
              showNotification("Code disalin (manual)", "success");
            });
        } else {
          showNotification("Generate sync code terlebih dahulu", "warning");
        }
      }

      function exportToFile() {
        try {
          const syncData = {
            orders: orders,
            timestamp: new Date().toISOString(),
            generatedBy: currentUser ? currentUser.name : "Unknown",
          };

          const dataStr = JSON.stringify(syncData, null, 2);
          const dataBlob = new Blob([dataStr], { type: "application/json" });
          const url = URL.createObjectURL(dataBlob);
          const link = document.createElement("a");
          link.href = url;
          link.download = `warung-online-orders-${
            new Date().toISOString().split("T")[0]
          }.json`;
          link.click();
          URL.revokeObjectURL(url);

          showNotification("File berhasil diexport!", "success");
        } catch (error) {
          showNotification("Gagal export file", "danger");
        }
      }

      function importFromCode() {
        const importCode = document.getElementById("importCode").value.trim();

        if (!importCode) {
          showNotification("Masukkan sync code terlebih dahulu", "warning");
          return;
        }

        try {
          const decodedData = atob(importCode);
          const importedData = JSON.parse(decodedData);

          if (importedData.orders && Array.isArray(importedData.orders)) {
            let importedCount = 0;

            // Merge orders, avoid duplicates
            importedData.orders.forEach((newOrder) => {
              const exists = orders.find((order) => order.id === newOrder.id);
              if (!exists) {
                orders.push(newOrder);
                importedCount++;
              }
            });

            if (importedCount > 0) {
              saveOrders();

              if (currentView === "admin") {
                renderOrders();
              } else if (currentView === "customer") {
                renderCustomerHistory();
              }

              showNotification(
                `Berhasil mengimpor ${importedCount} pesanan!`,
                "success"
              );
              updateSyncStats();
            } else {
              showNotification("Tidak ada data baru yang diimpor", "info");
            }
          } else {
            showNotification("Format data tidak valid", "danger");
          }
        } catch (error) {
          showNotification("Sync code tidak valid", "danger");
          console.error("Import error:", error);
        }
      }

      function importFromFile(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const importedData = JSON.parse(e.target.result);

            if (importedData.orders && Array.isArray(importedData.orders)) {
              let importedCount = 0;

              // Merge orders, avoid duplicates
              importedData.orders.forEach((newOrder) => {
                const exists = orders.find((order) => order.id === newOrder.id);
                if (!exists) {
                  orders.push(newOrder);
                  importedCount++;
                }
              });

              if (importedCount > 0) {
                saveOrders();

                if (currentView === "admin") {
                  renderOrders();
                } else if (currentView === "customer") {
                  renderCustomerHistory();
                }

                showNotification(
                  `Berhasil mengimpor ${importedCount} pesanan dari file!`,
                  "success"
                );
                updateSyncStats();
              } else {
                showNotification("Tidak ada data baru yang diimpor", "info");
              }
            } else {
              showNotification("Format file tidak valid", "danger");
            }
          } catch (error) {
            showNotification("Gagal membaca file", "danger");
            console.error("File import error:", error);
          }
        };
        reader.readAsText(file);
        // Reset file input
        event.target.value = "";
      }

      function clearImportCode() {
        document.getElementById("importCode").value = "";
      }

      function updateSyncStats() {
        document.getElementById("totalOrdersCount").textContent = orders.length;

        const uniqueCustomers = new Set(orders.map((order) => order.customerId))
          .size;
        document.getElementById("totalCustomersCount").textContent =
          uniqueCustomers;

        const lastSync = localStorage.getItem("warungOnlineLastSync");
        if (lastSync) {
          const date = new Date(lastSync);
          document.getElementById("lastSyncTime").textContent =
            date.toLocaleString("id-ID");
        }
      }

      function updateLastSyncTime() {
        localStorage.setItem("warungOnlineLastSync", new Date().toISOString());
      }

      // Event Listeners
      function setupEventListeners() {
        // Customer login form
        document
          .getElementById("customerLoginForm")
          .addEventListener("submit", handleCustomerLogin);

        // Admin login form
        document
          .getElementById("adminLoginForm")
          .addEventListener("submit", handleAdminLogin);

        // Navigation
        document.getElementById("homeLink")?.addEventListener("click", () => {
          if (isAdmin) showAdminDashboard();
          else if (currentUser) showCustomerView();
        });

        document.getElementById("menuLink")?.addEventListener("click", () => {
          if (isAdmin) showAdminDashboard();
          else if (currentUser) {
            showCustomerView();
            document
              .getElementById("menuSection")
              .scrollIntoView({ behavior: "smooth" });
          }
        });

        document
          .getElementById("historyLink")
          ?.addEventListener("click", () => {
            if (isAdmin) showAdminDashboard();
            else if (currentUser) {
              showCustomerView();
              document
                .getElementById("historySection")
                .scrollIntoView({ behavior: "smooth" });
            }
          });

        document
          .getElementById("adminLink")
          ?.addEventListener("click", showAdminLogin);

        // Cart
        document.getElementById("cartBtn")?.addEventListener("click", showCart);
        document
          .getElementById("closeCartBtn")
          ?.addEventListener("click", hideCart);
        document
          .getElementById("cartOverlay")
          ?.addEventListener("click", hideCart);
        document
          .getElementById("checkoutBtn")
          ?.addEventListener("click", showCheckoutModal);

        // Category filter
        document.querySelectorAll(".category-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            document
              .querySelectorAll(".category-btn")
              .forEach((b) => b.classList.remove("active"));
            this.classList.add("active");
            renderFoods(this.dataset.category);
          });
        });

        // Admin
        document
          .getElementById("logoutBtn")
          ?.addEventListener("click", handleLogout);
        document
          .getElementById("refreshBtn")
          ?.addEventListener("click", refreshOrders);

        // Search and filter
        document
          .getElementById("searchInput")
          ?.addEventListener("input", function (e) {
            searchTerm = e.target.value.toLowerCase();
            renderOrders();
          });

        document.querySelectorAll(".filter-pill").forEach((pill) => {
          pill.addEventListener("click", function () {
            document
              .querySelectorAll(".filter-pill")
              .forEach((p) => p.classList.remove("active"));
            this.classList.add("active");
            currentFilter = this.dataset.filter;
            renderOrders();
          });
        });

        // Checkout
        document
          .getElementById("confirmOrderBtn")
          ?.addEventListener("click", handleCheckout);

        // Delete confirmation
        document
          .getElementById("confirmDeleteBtn")
          ?.addEventListener("click", confirmDeleteOrder);
      }

      // Render Functions
      function renderFoods(category) {
        const foodGrid = document.getElementById("foodGrid");
        const filteredFoods =
          category === "all"
            ? foods
            : foods.filter((f) => f.category === category);

        foodGrid.innerHTML = filteredFoods
          .map(
            (food) => `
                <div class="col-md-6 col-lg-3">
                    <div class="food-card">
                        <img src="${food.image}" class="food-image" alt="${
              food.name
            }">
                        <div class="food-card-body">
                            <h5 class="food-title">${food.name}</h5>
                            <p class="food-description">${food.description}</p>
                            <div class="food-actions">
                                <span class="price-tag">Rp ${food.price.toLocaleString(
                                  "id-ID"
                                )}</span>
                                <button class="btn btn-primary-custom btn-custom" onclick="addToCart(${
                                  food.id
                                })">
                                    <i class="bi bi-cart-plus me-1"></i>Tambah
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `
          )
          .join("");
      }

      function renderCart() {
        const cartItems = document.getElementById("cartItems");
        const cartTotal = document.getElementById("cartTotal");

        if (cart.length === 0) {
          cartItems.innerHTML = `
                    <div class="text-center py-4">
                        <i class="bi bi-cart-x" style="font-size: 48px; color: #dee2e6;"></i>
                        <p class="mt-2 text-muted">Keranjang kosong</p>
                    </div>
                `;
          cartTotal.textContent = "Rp 0";
          return;
        }

        cartItems.innerHTML = cart
          .map(
            (item) => `
                <div class="card mb-2">
                    <div class="card-body p-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">${item.name}</h6>
                                <small class="text-muted">Rp ${item.price.toLocaleString(
                                  "id-ID"
                                )} x ${item.quantity}</small>
                            </div>
                            <div class="d-flex align-items-center">
                                <button class="btn btn-sm btn-outline-danger" onclick="updateQuantity(${
                                  item.id
                                }, -1)">
                                    <i class="bi bi-dash"></i>
                                </button>
                                <span class="mx-2 fw-bold">${
                                  item.quantity
                                }</span>
                                <button class="btn btn-sm btn-outline-danger" onclick="updateQuantity(${
                                  item.id
                                }, 1)">
                                    <i class="bi bi-plus"></i>
                                </button>
                                <button class="btn btn-sm btn-danger ms-2" onclick="removeFromCart(${
                                  item.id
                                })">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `
          )
          .join("");

        const total = cart.reduce(
          (sum, item) => sum + item.price * item.quantity,
          0
        );
        cartTotal.textContent = `Rp ${total.toLocaleString("id-ID")}`;
      }

      function renderOrders() {
        const ordersList = document.getElementById("ordersList");

        let filteredOrders = orders;

        if (currentFilter !== "all") {
          filteredOrders = filteredOrders.filter(
            (order) => order.status === currentFilter
          );
        }

        if (searchTerm) {
          filteredOrders = filteredOrders.filter(
            (order) =>
              order.customerName.toLowerCase().includes(searchTerm) ||
              order.customerPhone.includes(searchTerm) ||
              order.items.some((item) =>
                item.name.toLowerCase().includes(searchTerm)
              )
          );
        }

        if (filteredOrders.length === 0) {
          ordersList.innerHTML = `
                    <div class="text-center py-4">
                        <i class="bi bi-inbox" style="font-size: 48px; color: #dee2e6;"></i>
                        <p class="mt-2 text-muted">Tidak ada pesanan</p>
                        <button class="btn btn-outline-danger btn-sm mt-2" onclick="showSyncModal()">
                            <i class="bi bi-arrow-left-right me-1"></i>Import Data
                        </button>
                    </div>
                `;
          updateStatistics();
          return;
        }

        ordersList.innerHTML = filteredOrders
          .map(
            (order) => `
                <div class="order-card">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div>
                                    <h6 class="fw-bold mb-1">Order #${
                                      order.id
                                    }</h6>
                                    <small class="text-muted">
                                        <i class="bi bi-clock me-1"></i>
                                        ${new Date(
                                          order.timestamp
                                        ).toLocaleString("id-ID")}
                                    </small>
                                </div>
                                <span class="status-badge status-${
                                  order.status
                                }">${getStatusText(order.status)}</span>
                            </div>
                            <div class="mb-2">
                                <p class="mb-1"><strong>Pelanggan:</strong> ${
                                  order.customerName
                                }</p>
                                <p class="mb-1"><strong>Telepon:</strong> ${
                                  order.customerPhone
                                }</p>
                                <p class="mb-1"><strong>Alamat:</strong> ${
                                  order.customerAddress
                                }</p>
                                <p class="mb-1"><strong>Pembayaran:</strong> ${
                                  order.paymentMethod
                                }</p>
                            </div>
                            <div>
                                <strong class="d-block mb-1">Items:</strong>
                                <div class="row g-1">
                                    ${order.items
                                      .map(
                                        (item) => `
                                        <div class="col-12">
                                            <div class="d-flex justify-content-between align-items-center bg-light p-2 rounded">
                                                <span>${item.name} x${
                                          item.quantity
                                        }</span>
                                                <span class="fw-bold">Rp ${(
                                                  item.price * item.quantity
                                                ).toLocaleString(
                                                  "id-ID"
                                                )}</span>
                                            </div>
                                        </div>
                                    `
                                      )
                                      .join("")}
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <h5 class="text-danger fw-bold mb-2">Rp ${order.total.toLocaleString(
                              "id-ID"
                            )}</h5>
                            <div class="d-grid gap-1">
                                ${
                                  order.status !== "completed"
                                    ? `
                                    <select class="form-select form-select-sm" onchange="updateOrderStatus(${
                                      order.id
                                    }, this.value)">
                                        <option value="pending" ${
                                          order.status === "pending"
                                            ? "selected"
                                            : ""
                                        }>Menunggu</option>
                                        <option value="processing" ${
                                          order.status === "processing"
                                            ? "selected"
                                            : ""
                                        }>Diproses</option>
                                        <option value="ready" ${
                                          order.status === "ready"
                                            ? "selected"
                                            : ""
                                        }>Siap Diambil</option>
                                        <option value="completed" ${
                                          order.status === "completed"
                                            ? "selected"
                                            : ""
                                        }>Selesai</option>
                                    </select>
                                `
                                    : `
                                    <button class="btn btn-danger btn-sm w-100" onclick="showDeleteConfirmation(${order.id})">
                                        <i class="bi bi-trash me-1"></i>Hapus
                                    </button>
                                `
                                }
                            </div>
                        </div>
                    </div>
                </div>
            `
          )
          .join("");

        updateStatistics();
      }

      function renderCustomerHistory() {
        const historyContainer = document.getElementById("customerHistory");

        if (!currentUser) {
          historyContainer.innerHTML = `
                    <div class="text-center py-4">
                        <i class="bi bi-person-x" style="font-size: 48px; color: #dee2e6;"></i>
                        <p class="mt-2 text-muted">Silakan login terlebih dahulu</p>
                    </div>
                `;
          return;
        }

        const customerOrders = orders.filter(
          (order) => order.customerId === currentUser.id
        );

        if (customerOrders.length === 0) {
          historyContainer.innerHTML = `
                    <div class="text-center py-4">
                        <i class="bi bi-clock-history" style="font-size: 48px; color: #dee2e6;"></i>
                        <p class="mt-2 text-muted">Belum ada riwayat pesanan</p>
                    </div>
                `;
          return;
        }

        historyContainer.innerHTML = customerOrders
          .map(
            (order) => `
                <div class="history-item ${
                  order.status === "ready" ? "ready-order" : ""
                }" data-order-id="${order.id}">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6 class="fw-bold mb-0">Order #${order.id}</h6>
                                <span class="status-badge status-${
                                  order.status
                                }">${getStatusText(order.status)}</span>
                            </div>
                            <p class="text-muted mb-2">
                                <i class="bi bi-clock me-1"></i>
                                ${new Date(order.timestamp).toLocaleString(
                                  "id-ID"
                                )}
                            </p>
                            <div class="mb-2">
                                <strong>Items:</strong>
                                <span class="ms-2">${order.items
                                  .map(
                                    (item) => `${item.name} x${item.quantity}`
                                  )
                                  .join(", ")}</span>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <h5 class="text-danger fw-bold mb-0">Rp ${order.total.toLocaleString(
                              "id-ID"
                            )}</h5>
                        </div>
                    </div>
                </div>
            `
          )
          .join("");
      }

      function updateStatistics() {
        const totalOrders = orders.length;
        const pendingOrders = orders.filter(
          (o) => o.status === "pending"
        ).length;
        const processingOrders = orders.filter(
          (o) => o.status === "processing"
        ).length;
        const completedOrders = orders.filter(
          (o) => o.status === "completed"
        ).length;

        document.getElementById("totalOrders").textContent = totalOrders;
        document.getElementById("pendingOrders").textContent = pendingOrders;
        document.getElementById("processingOrders").textContent =
          processingOrders;
        document.getElementById("completedOrders").textContent =
          completedOrders;
      }

      // Cart Functions
      function addToCart(foodId) {
        if (!currentUser) {
          showNotification("Silakan login terlebih dahulu", "warning");
          return;
        }

        const food = foods.find((f) => f.id === foodId);
        const existingItem = cart.find((item) => item.id === foodId);

        if (existingItem) {
          existingItem.quantity++;
        } else {
          cart.push({ ...food, quantity: 1 });
        }

        updateCartBadge();
        renderCart();
        showCart();
        showNotification(`${food.name} ditambahkan`, "success");
      }

      function updateQuantity(foodId, change) {
        const item = cart.find((item) => item.id === foodId);
        if (item) {
          item.quantity += change;
          if (item.quantity <= 0) {
            removeFromCart(foodId);
          } else {
            updateCartBadge();
            renderCart();
          }
        }
      }

      function removeFromCart(foodId) {
        const item = cart.find((item) => item.id === foodId);
        cart = cart.filter((item) => item.id !== foodId);
        updateCartBadge();
        renderCart();
        showNotification(`${item.name} dihapus`, "warning");
      }

      function updateCartBadge() {
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        document.getElementById("cartBadge").textContent = totalItems;
      }

      function showCart() {
        renderCart();
        document.getElementById("cartSidebar").classList.add("show");
        document.getElementById("cartOverlay").classList.add("show");
      }

      function hideCart() {
        document.getElementById("cartSidebar").classList.remove("show");
        document.getElementById("cartOverlay").classList.remove("show");
      }

      function showCheckoutModal() {
        if (!currentUser) {
          showNotification("Silakan login terlebih dahulu", "warning");
          return;
        }

        if (cart.length === 0) {
          showNotification("Keranjang kosong!", "warning");
          return;
        }

        // Set customer name in checkout modal
        document.getElementById("checkoutCustomerName").textContent =
          currentUser.name;

        // Show order summary
        const orderSummary = document.getElementById("orderSummary");
        const total = cart.reduce(
          (sum, item) => sum + item.price * item.quantity,
          0
        );

        orderSummary.innerHTML = `
                <div class="bg-light p-3 rounded">
                    <h6 class="fw-bold mb-2">Ringkasan Pesanan:</h6>
                    ${cart
                      .map(
                        (item) => `
                        <div class="d-flex justify-content-between mb-1">
                            <span>${item.name} x${item.quantity}</span>
                            <span>Rp ${(
                              item.price * item.quantity
                            ).toLocaleString("id-ID")}</span>
                        </div>
                    `
                      )
                      .join("")}
                    <hr>
                    <div class="d-flex justify-content-between fw-bold">
                        <span>Total:</span>
                        <span>Rp ${total.toLocaleString("id-ID")}</span>
                    </div>
                </div>
            `;

        const modal = new bootstrap.Modal(
          document.getElementById("checkoutModal")
        );
        modal.show();
      }

      function handleCheckout() {
        const paymentMethod = document.getElementById("paymentMethod").value;
        if (!paymentMethod) {
          showNotification("Pilih metode pembayaran", "warning");
          return;
        }

        const order = {
          id: Date.now(),
          customerId: currentUser.id,
          customerName: currentUser.name,
          customerPhone: currentUser.phone,
          customerAddress: currentUser.address,
          paymentMethod: paymentMethod,
          items: [...cart],
          total: cart.reduce(
            (sum, item) => sum + item.price * item.quantity,
            0
          ),
          status: "pending",
          timestamp: new Date().toISOString(),
        };

        orders.unshift(order);
        saveOrders();

        cart = [];
        updateCartBadge();
        hideCart();

        const modal = bootstrap.Modal.getInstance(
          document.getElementById("checkoutModal")
        );
        modal.hide();

        document.getElementById("paymentMethod").value = "";
        showNotification("Pesanan berhasil dibuat!", "success");
        renderCustomerHistory();
      }

      // Authentication Functions
      function handleCustomerLogin(e) {
        e.preventDefault();

        const name = document.getElementById("customerName").value;
        const phone = document.getElementById("customerPhone").value;
        const address = document.getElementById("customerAddress").value;

        currentUser = {
          id: "customer_" + Date.now(),
          name: name,
          phone: phone,
          address: address,
          isAdmin: false,
        };

        // Save to localStorage
        localStorage.setItem("warungOnlineUser", JSON.stringify(currentUser));

        showCustomerView();
        showNotification(`Selamat datang, ${name}!`, "success");
      }

      function handleAdminLogin(e) {
        e.preventDefault();

        const username = document.getElementById("adminUsername").value;
        const password = document.getElementById("adminPassword").value;

        if (username === "admin" && password === "admin123") {
          currentUser = {
            id: "admin_" + Date.now(),
            name: "Admin",
            phone: "-",
            address: "-",
            isAdmin: true,
          };

          localStorage.setItem("warungOnlineUser", JSON.stringify(currentUser));

          showAdminDashboard();
          showNotification("Login admin berhasil!", "success");
        } else {
          showNotification("Username atau password salah!", "danger");
        }
      }

      function customerLogout() {
        currentUser = null;
        lastNotifiedOrders.clear(); // Clear notified orders on logout
        localStorage.removeItem("warungOnlineUser");
        showCustomerLogin();
        showNotification("Logout berhasil!", "info");
      }

      function handleLogout() {
        currentUser = null;
        isAdmin = false;
        lastNotifiedOrders.clear(); // Clear notified orders on logout
        localStorage.removeItem("warungOnlineUser");
        showCustomerLogin();
        showNotification("Logout berhasil!", "info");
      }

      // View Functions
      function showCustomerLogin() {
        currentView = "customerLogin";
        document.getElementById("customerLogin").style.display = "block";
        document.getElementById("customerView").style.display = "none";
        document.getElementById("adminLogin").style.display = "none";
        document.getElementById("adminDashboard").style.display = "none";
        document.getElementById("realtimeIndicator").style.display = "none";
      }

      function showCustomerView() {
        currentView = "customer";
        document.getElementById("customerLogin").style.display = "none";
        document.getElementById("customerView").style.display = "block";
        document.getElementById("adminLogin").style.display = "none";
        document.getElementById("adminDashboard").style.display = "none";
        document.getElementById("realtimeIndicator").style.display = "flex";

        // Update customer info
        if (currentUser) {
          document.getElementById("welcomeCustomerName").textContent =
            currentUser.name;
          document.getElementById("welcomeCustomerPhone").textContent =
            currentUser.phone;
        }

        // Render foods menu
        renderFoods("all");
        renderCustomerHistory();
      }

      function showAdminLogin() {
        currentView = "adminLogin";
        document.getElementById("customerLogin").style.display = "none";
        document.getElementById("customerView").style.display = "none";
        document.getElementById("adminLogin").style.display = "block";
        document.getElementById("adminDashboard").style.display = "none";
        document.getElementById("realtimeIndicator").style.display = "none";
      }

      function showAdminDashboard() {
        currentView = "admin";
        isAdmin = true;
        document.getElementById("customerLogin").style.display = "none";
        document.getElementById("customerView").style.display = "none";
        document.getElementById("adminLogin").style.display = "none";
        document.getElementById("adminDashboard").style.display = "block";
        document.getElementById("realtimeIndicator").style.display = "flex";

        loadOrders();
        renderOrders();
      }

      // Admin Functions
      function refreshOrders() {
        loadOrders();
        renderOrders();
        showNotification("Data diperbarui!", "info");
      }

      function refreshCustomerHistory() {
        loadOrders();
        renderCustomerHistory();
        showNotification("Riwayat diperbarui!", "info");
      }

      function updateOrderStatus(orderId, newStatus) {
        const order = orders.find((o) => o.id === orderId);
        if (order) {
          const oldStatus = order.status;
          order.status = newStatus;
          saveOrders();
          renderOrders();
          renderCustomerHistory();
          showNotification("Status pesanan diperbarui!", "success");

          console.log(
            `Order ${orderId} status changed from ${oldStatus} to ${newStatus}`
          );
        }
      }

      function getStatusText(status) {
        const statusMap = {
          pending: "Menunggu",
          processing: "Diproses",
          ready: "Siap Diambil",
          completed: "Selesai",
        };
        return statusMap[status] || status;
      }

      // Delete order functions
      function showDeleteConfirmation(orderId) {
        orderToDelete = orderId;
        const modal = new bootstrap.Modal(
          document.getElementById("deleteModal")
        );
        modal.show();
      }

      function confirmDeleteOrder() {
        if (orderToDelete) {
          orders = orders.filter((order) => order.id !== orderToDelete);
          saveOrders();
          renderOrders();
          renderCustomerHistory();
          showNotification("Pesanan dihapus!", "success");

          const modal = bootstrap.Modal.getInstance(
            document.getElementById("deleteModal")
          );
          modal.hide();

          orderToDelete = null;
        }
      }

      // Notification function
      function showNotification(message, type = "info") {
        const notification = document.getElementById("notification");
        const notificationText = document.getElementById("notificationText");

        notificationText.textContent = message;
        notification.className = "notification";

        const colors = {
          success: "#28a745",
          warning: "#ffc107",
          danger: "#dc3545",
          info: "#17a2b8",
        };

        notification.style.borderLeftColor = colors[type] || colors.info;
        notification.style.display = "block";

        setTimeout(() => {
          notification.style.display = "none";
        }, 3000);
      }

      // Ganti fungsi setupLocalStorageListener yang ada dengan ini
      function setupLocalStorageListener() {
        // Buat custom event untuk notifikasi real-time
        window.addEventListener("storage", function (event) {
          if (event.key === "warungOnlineOrders") {
            console.log("Perubahan data terdeteksi, memperbarui tampilan...");
            loadOrders();

            // Update UI berdasarkan view saat ini
            if (currentView === "admin") {
              renderOrders();
            } else if (currentView === "customer") {
              renderCustomerHistory();
            }

            // Periksa update status pesanan segera
            checkOrderStatusUpdates();
          }

          // Deteksi perubahan status pesanan
          if (event.key === "warungOrderStatusUpdate") {
            try {
              const statusUpdate = JSON.parse(event.newValue);
              console.log("Update status pesanan terdeteksi:", statusUpdate);

              // Muat ulang data dan periksa notifikasi
              loadOrders();
              checkOrderStatusUpdates();
            } catch (error) {
              console.error("Error parsing status update:", error);
            }
          }
        });
      }

      // Ganti fungsi updateOrderStatus yang ada dengan ini
      function updateOrderStatus(orderId, newStatus) {
        const order = orders.find((o) => o.id === orderId);
        if (order) {
          const oldStatus = order.status;
          order.status = newStatus;
          saveOrders();
          renderOrders();
          renderCustomerHistory();
          showNotification("Status pesanan diperbarui!", "success");

          console.log(
            `Pesanan #${orderId} berubah dari ${oldStatus} ke ${newStatus}`
          );

          // Jika status berubah menjadi 'ready', kirim notifikasi real-time
          if (newStatus === "ready") {
            // Simpan update status ke localStorage khusus
            localStorage.setItem(
              "warungOrderStatusUpdate",
              JSON.stringify({
                orderId: orderId,
                status: newStatus,
                timestamp: new Date().toISOString(),
                customerName: order.customerName,
              })
            );

            // Hapus setelah disimpan untuk memicu event storage
            setTimeout(() => {
              localStorage.removeItem("warungOrderStatusUpdate");
            }, 100);
          }
        }
      }

      // Ganti fungsi checkOrderStatusUpdates yang ada dengan ini
      function checkOrderStatusUpdates() {
        if (!currentUser || currentUser.isAdmin) return;

        // Muat ulang pesanan terbaru dari localStorage
        loadOrders();

        const customerOrders = orders.filter(
          (order) => order.customerId === currentUser.id
        );

        customerOrders.forEach((order) => {
          // Cek apakah pesanan sudah siap dan belum diberi notifikasi
          if (order.status === "ready" && !lastNotifiedOrders.has(order.id)) {
            console.log("Pesanan siap terdeteksi:", order.id);
            showOrderReadyNotification(order);
            lastNotifiedOrders.add(order.id);

            // Simpan set pesanan yang sudah diberi notifikasi ke localStorage
            localStorage.setItem(
              "warungOnlineNotifiedOrders",
              JSON.stringify([...lastNotifiedOrders])
            );

            // Highlight pesanan di riwayat
            highlightOrderInHistory(order.id);
          }
        });
      }

      // Tambahkan fungsi ini untuk memuat notifikasi yang sudah dikirim
      function loadNotifiedOrders() {
        try {
          const notifiedOrders = localStorage.getItem(
            "warungOnlineNotifiedOrders"
          );
          if (notifiedOrders) {
            lastNotifiedOrders = new Set(JSON.parse(notifiedOrders));
          }
        } catch (error) {
          console.error("Error loading notified orders:", error);
          lastNotifiedOrders = new Set();
        }
      }

      // Perbaiki fungsi saveOrders
      function saveOrders() {
        try {
          localStorage.setItem("warungOnlineOrders", JSON.stringify(orders));
          updateLastSyncTime();

          // Trigger storage event dengan menulis ke kunci sementara
          const tempKey = "warungOnlineOrders_" + Date.now();
          localStorage.setItem(tempKey, "refresh");
          localStorage.removeItem(tempKey);

          console.log("Data pesanan tersimpan:", orders.length);
        } catch (error) {
          console.error("Error saving orders:", error);
          showNotification("Gagal menyimpan data", "danger");
        }
      }

      // Perbaiki fungsi loadOrders
      function loadOrders() {
        try {
          const storedOrders = localStorage.getItem("warungOnlineOrders");
          if (storedOrders) {
            orders = JSON.parse(storedOrders);
            console.log("Data pesanan dimuat:", orders.length);
          }
        } catch (error) {
          console.error("Error loading orders:", error);
          orders = [];
        }
      }

      // Perbaiki fungsi initialize
      document.addEventListener("DOMContentLoaded", function () {
        checkURLParams();
        loadOrders();
        loadNotifiedOrders(); // Tambahkan ini
        setupEventListeners();

        // Auto save setiap 5 detik
        setInterval(autoSave, 5000);

        // Check for order status updates setiap 1 detik
        setInterval(checkOrderStatusUpdates, 1000);

        // Setup localStorage event listener
        setupLocalStorageListener();

        // Check if user is already logged in
        checkExistingLogin();
      });

      // Perbaiki fungsi customerLogout dan handleLogout
      function customerLogout() {
        currentUser = null;
        lastNotifiedOrders.clear();
        localStorage.removeItem("warungOnlineUser");
        localStorage.removeItem("warungOnlineNotifiedOrders");
        showCustomerLogin();
        showNotification("Logout berhasil!", "info");
      }

      function handleLogout() {
        currentUser = null;
        isAdmin = false;
        lastNotifiedOrders.clear();
        localStorage.removeItem("warungOnlineUser");
        localStorage.removeItem("warungOnlineNotifiedOrders");
        showCustomerLogin();
        showNotification("Logout berhasil!", "info");
      }
    </script>
  </body>
</html>
